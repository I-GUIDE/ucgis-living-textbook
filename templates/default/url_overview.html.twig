{% extends 'single_column.html.twig' %}

{% block before_title %}
  {% from '_macro/_action_bar.html.twig' import action_button %}
  {{ action_button(path('app_default_urlrescanstudyarea'), 'fa-repeat', 'url.rescan-study-area'|trans, 'warning') }}
{% endblock %}

{% block title %}
  {{ 'url.overview-title'|trans }}
{% endblock %}

{% macro urlTable(urls, status, title, learningPathElements) %}
  {% if urls is not empty %}
    <h3>{{ title|trans }}</h3>
    <div class="table-responsive">
      <table class="table">
        <thead>
        <tr>
          <th scope="col">{{ 'url.url'|trans }}</th>
          <th scope="col">{{ 'url.status'|trans }}</th>
          <th scope="col">{{ 'form.edit'|trans }}</th>
          <th scope="col">{{ 'url.rescan'|trans }}</th>
        </tr>
        </thead>
        <tbody>
        {% for url in urls %}
          {% if url.context.class == 'App\\Entity\\StudyArea' %}
            {% set description = 'url.study-area-path' %}
            {% set editUrl = path('app_studyarea_edit', {'studyArea': url.context.id}) %}
            {% set descriptionArgs = {'%path%': ('study-area.' ~ url.context.pathAsTransKey)|trans} %}
          {% elseif url.context.class == 'App\\Entity\\Concept' %}
            {% set description = 'url.concept-path' %}
            {% set editUrl = path('app_concept_edit', {'concept': url.context.id}) %}
            {% set descriptionArgs = {'%path%': ('concept.' ~ url.context.pathAsTransKey)|trans} %}
          {% elseif url.context.class == 'App\\Entity\\LearningOutcome' %}
            {% set description = 'url.learning-outcome-path' %}
            {% set editUrl = path('app_learningoutcome_edit', {'learningOutcome': url.context.id}) %}
            {% set descriptionArgs = {'%path%': ('learning-outcome.' ~ url.context.pathAsTransKey)|trans} %}
          {% elseif url.context.class == 'App\\Entity\\ExternalResource' %}
            {% set description = 'url.external-resource-path' %}
            {% set editUrl = path('app_externalresource_edit', {'externalResource': url.context.id}) %}
            {% set descriptionArgs = {'%path%': ('external-resource.' ~ url.context.pathAsTransKey)|trans} %}
          {% elseif url.context.class == 'App\\Entity\\LearningPath' %}
            {% set description = 'url.learning-path-path' %}
            {% set editUrl = path('app_learningpath_edit', {'learningPath': url.context.id}) %}
            {% set descriptionArgs = {'%path%': ('learning-path.' ~ url.context.pathAsTransKey)|trans} %}
          {% else %}
            {% set description = 'url.unknown' %}
            {% set editUrl = '' %}
          {% endif %}
          <tr>
            <td class="break-all ba-60">
              <a href="{{ url.url }}" target="_blank">{{ url.url }}</a>
            </td>
            <td>
              {{ status|trans }}
            </td>
            <td>
              {% if editUrl != '' %}
                <a href="{{ editUrl }}">{{ description|trans(descriptionArgs) }}</a>
              {% else %}
                {{ description|trans }}
              {% endif %}
            </td>
            <td>
              <a class="btn btn-outline-primary"
                 href="{{ path('app_default_urlrescan', {'url': url.url|url_encode}) }}">
                <i class="fa fa-fw fa-repeat"></i>
                {{ 'url.rescan'|trans }}</a>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
{% endmacro %}

{% block content %}
  {% if lastScanned is not null %}
    <p>
      {{ 'url.last-scanned'|trans({'%date%': lastScanned|date('d M Y H:i')}) }}
    </p>
    {% from _self import urlTable %}
    {{ urlTable(badExternalUrls, 'url.bad', 'url.bad-external') }}
    {{ urlTable(badInternalUrls, 'url.internal-wrong', 'url.bad-internal') }}
    {{ urlTable(goodExternalUrls, 'url.good', 'url.good-external') }}
    {{ urlTable(goodInternalUrls, 'url.good', 'url.good-internal') }}
    {{ urlTable(unscannedExternalUrls, 'url.unscanned', 'url.unscanned-external') }}
    {{ urlTable(unscannedInternalUrls, 'url.unscanned', 'url.unscanned-internal') }}

  {% else %}
    {{ 'url.urls-unscanned'|trans }}
  {% endif %}
{% endblock %}
