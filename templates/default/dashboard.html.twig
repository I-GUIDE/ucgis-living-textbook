{% extends 'single_column.html.twig' %}

{% block title %}
  {{ 'app.dashboard'|trans }}
{% endblock %}

{% block content %}
  <h2>{{ 'dashboard.study-area-text'|trans({'%studyArea%': studyArea.name}) }}</h2>

  <p>{{ 'dashboard.study-area-contains'|trans() }}</p>
  <ul>
    <li>
      {% if conceptCount > 0 %}<a href="{{ path('app_concept_list') }}">{% endif %}
        {{ 'dashboard.concept-count'|transchoice(conceptCount) }}
        {% if conceptCount > 0 %}</a>{% endif %}
    </li>
    <li>
      {% if abbreviationCount > 0 %}<a href="{{ path('app_abbreviation_list') }}">{% endif %}
        {{ 'dashboard.abbreviation-count'|transchoice(abbreviationCount) }}
        {% if abbreviationCount > 0 %}</a>{% endif %}
    </li>
    <li>
      {% if externalResourceCount > 0 %}<a href="{{ path('app_externalresource_list') }}">{% endif %}
        {{ 'dashboard.external-resource-count'|transchoice(externalResourceCount) }}
      {% if externalResourceCount > 0 %}</a>{% endif %}
    </li>
    <li>
      {% if learningOutcomeCount > 0 %}<a href="{{ path('app_learningoutcome_list') }}">{% endif %}
        {{ 'dashboard.learning-outcome-count'|transchoice(learningOutcomeCount) }}
        {% if learningOutcomeCount > 0 %}</a>{% endif %}
    </li>
  </ul>

  <h4>{{ 'dashboard.study-area-switch'|trans }}</h4>
  {% if form is not null %}
    {{ form_start(form) }}
    <div class="row">
      <div class="col-sm-12 col-md-5 col-lg-3 mt-1">
        {{ form_widget(form.studyArea) }}
      </div>
      <div class="col mt-1">
        {{ form_widget(form.submit) }}
      </div>
    </div>

    <script type="text/javascript">
      $('#form_studyArea').on('change', function () {
        $('#form_submit').removeAttr('disabled');
      });

      $('#form_submit').on('click', function () {
        eDispatch.pageLoad(Routing.generate('_home', {'_studyArea': $('#form_studyArea').val()}), {topLevel: true});
        return false;
      });
    </script>

    {{ form_end(form) }}
  {% endif %}
{% endblock %}

{% block second_content %}
  {% if form is not null %}
    <div class="card container-card">
      <div class="card-body">
        {% from '_macro/_action_bar.html.twig' import new_bar %}
        {{ new_bar(path('app_studyarea_add')) }}

        <h1>{{ 'study-area.list-title'|trans }}</h1>

        <table class="table">
          <thead>
          <tr>
            <th scope="col">{{ 'study-area.name'|trans }}</th>
            <th scope="col">{{ 'study-area.owner'|trans }}</th>
            <th scope="col">{{ 'study-area.access-type'|trans }}</th>
            <th scope="col">{{ 'study-area.switch-to'|trans }}</th>
            <th scope="col">{{ 'form.show'|trans }}</th>
            <th scope="col">{{ 'form.edit'|trans }}</th>
            <th scope="col">{{ 'form.remove'|trans }}</th>
          </tr>
          </thead>
          <tbody>
          {% for studyArea in studyAreas %}
            <tr>
              <td>{{ studyArea.name }}</td>
              <td>
                {% if is_granted('STUDYAREA_OWNER', studyArea) %}
                  <a href="{{ path('app_studyarea_transferowner', {'studyArea': studyArea.id}) }}"
                     data-toggle="tooltip" title="{{ 'study-area.transfer-ownership'|trans }}">
                    {{ studyArea.owner.displayName }}</a>
                {% else %}
                  {{ studyArea.owner.displayName }}
                {% endif %}
              </td>
              <td>{{ studyArea.accessType|capitalize }}</td>
              <td>
                {% if studyArea.id == currentStudyArea.id %}
                  {{ 'study-area.current'|trans }}
                {% else %}
                  <a class="top-level" href="{{ path('_home', {'_studyArea': studyArea.id}) }}">{{ 'study-area.switch-to'|trans }}</a>
                {% endif %}
              </td>
              <td><a href="{{ path('app_studyarea_show', {'studyArea': studyArea.id}) }}">{{ 'form.show'|trans }}</a></td>
              {% if is_granted('STUDYAREA_OWNER', studyArea) %}
                <td><a href="{{ path('app_studyarea_edit', {'studyArea': studyArea.id}) }}">{{ 'form.edit'|trans }}</a></td>
                <td><a href="{{ path('app_studyarea_remove', {'studyArea': studyArea.id}) }}">{{ 'form.remove'|trans }}</a></td>
              {% else %}
                <td></td><td></td>
              {% endif %}
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endif %}
{% endblock %}
