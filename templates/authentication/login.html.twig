{% extends 'default/landing.html.twig' %}

{% block enter %}
  <p class="card-text">{{ 'login.login-text'|trans }} {{ 'login.privacy-policy-text'|trans }}
    <a href="https://www.utwente.nl/en/about-our-website/" target="_blank" class="no-block">
      {{ 'login.privacy-policy'|trans|lower }}</a>.
  </p>

  {% from '_layout/flashbags.html.twig' import flashbag_alert %}

  {# Authentication error messages #}
  {% for flashMessage in app.session.flashbag.get('authError') %}
    {{ flashbag_alert('danger', flashMessage, 'fa-exclamation-triangle', false) }}
  {% endfor %}

  <ul class="nav nav-tabs nav-fill">
    <li class="nav-item">
      <a class="nav-link{% if not formActive %} active{% endif %}"
         id="tab-surfconext-button" href="#tab-surfconext" role="tab" data-toggle="tab">
        {{ 'login.surfconext'|trans }}
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link{% if formActive %} active{% endif %}"
         onclick="focusLoginForm()"
         id="tab-custom-account-button" href="#tab-custom-account" role="tab" data-toggle="tab">
        {{ 'login.custom-account'|trans }}
      </a>
    </li>
  </ul>
  <div class="tab-content" id="login-option">
    <div class="tab-pane" id="tab-surfconext" role="tabpanel" aria-labelledby="tab-surfconext-button">
      <a href="{{ path('login_surf') }}" class="top-level" data-toggle="tooltip" data-placement="bottom"
         title="{{ 'login.surfconext-login'|trans }}">
        <div class="login-surfconext"></div>
      </a>
      <p class="card-text text-center">{{ 'login.surfconext-login-text'|trans }}</p>
    </div>

    <div class="tab-pane" id="tab-custom-account" role="tabpanel" aria-labelledby="tab-custom-account-button">
      {{ form(form, {'attr': {'target': '_parent'}}) }}
    </div>
  </div>
{% endblock %}

{% block delete_notice %}
{% endblock %}

{% block javascripts_bottom %}
  {{ parent() }}
  <script type="text/javascript">
    // Focus form input
    function focusLoginForm() {
      setTimeout(function () {
        $('#login__username').focus();
      }, 100);
    }

    function updateTabHeight() {
      // Fixate the tab height
      var maxHeight = 0;
      $('.tab-content .tab-pane').each(function () {
        $(this).addClass('active');
        var height = $(this).height();
        maxHeight = height > maxHeight ? height : maxHeight;
        $(this).removeClass('active');
      });
      {% if formActive %}
      $('#tab-custom-account').addClass('active');
      focusLoginForm();
      {% else %}
      $('.tab-content .tab-pane:first').addClass('active');
      {% endif %}
      $('.tab-content').height(maxHeight);
    }

    $(function () {
      setTimeout(updateTabHeight, 100);
      window.onresize = updateTabHeight;
    });
  </script>
{% endblock %}
