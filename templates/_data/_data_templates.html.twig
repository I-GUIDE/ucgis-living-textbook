{% block data_display_block %}
  {% if data.hasData %}
    {% if title is defined %}
      <h2 data-annotations-contains-text="false"
          data-annotations-context="{{ annotationContext|default('') }}">
        {{ title }}<span class="header-marker">&#xfeff;</span>
      </h2>
    {% endif %}
    <div class="ltb-text-container"
         data-annotations-contains-text="true"
         data-annotations-context="{{ annotationContext|default('') }}"
         data-annotations-version="{{ data.lastUpdated|default('now'|date)|date('c') }}">
      {{ data.text|striptags(allowed_ckeditor_tags)|raw }}
    </div>
  {% endif %}
{% endblock %}

{% macro data_definition(concept) %}
  {% if concept.definition|length > 0 %}
    <p data-annotations-contains-text="true"
       data-annotations-context="definition"
       data-annotations-version="{{ concept.lastUpdated|default('now'|date)|date('c') }}">
      {{ concept.definition }}
    </p>
  {% endif %}
{% endmacro %}

{% macro data_introduction(data) %}
  {% set title = 'concept.introduction'|trans %}
  {% set annotationContext = 'introduction' %}
  {{ block('data_display_block') }}
{% endmacro %}

{% macro data_synonyms(data) %}
  {% if data|length > 0 %}
    <h2>{{ 'concept.synonyms'|trans }}</h2>
    <p>{{ data }}</p>
  {% endif %}
{% endmacro %}

{% macro data_theory_explanation(data) %}
  {% set title = 'concept.theory-explanation'|trans %}
  {% set annotationContext = 'theory_explanation' %}
  {{ block('data_display_block') }}
{% endmacro %}

{% macro data_how_to(data) %}
  {% set title = 'concept.how-to'|trans %}
  {% set annotationContext = 'how-to' %}
  {{ block('data_display_block') }}
{% endmacro %}

{% macro data_examples(data) %}
  {% set title = 'concept.examples'|trans %}
  {% set annotationContext = 'examples' %}
  {{ block('data_display_block') }}
{% endmacro %}

{% macro data_external_resources(data) %}
  {% if data|length > 0 %}
    <h2>{{ 'concept.external-resources'|trans }}</h2>
    <ul>
      {% for resource in data %}
        <li>
          {% if resource.url is not empty %}
            <a href="{{ resource.url }}" target="_blank">{{ resource.title }}</a>
          {% else %}
            {{ resource.title }}
          {% endif %}
          {% if resource.description is not null %}
            <br/>{{ resource.description }}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}

{% macro data_self_assessment(data) %}
  {% set title = 'concept.self-assessment'|trans %}
  {% set annotationContext = 'self-assesment' %}
  {{ block('data_display_block') }}
{% endmacro %}

{% block data_display_relations %}
  {% import _self as macros %}
  <h2>{{ title }}</h2>
  <ul>
    {% for relation in relations %}
      <li>
        {{ macros.link_to_relation(relation.source, incoming) }}
        <i>{{ relation.relationType.name|lower }}</i>
        {{ macros.link_to_relation(relation.target, not incoming) }}
      </li>
    {% endfor %}
  </ul>
{% endblock %}

{% macro link_to_relation(concept, createLink) %}
  {% if createLink %}
    <a href="{{ path('app_concept_show', {concept: concept.id}) }}">{{ concept.name }}</a>
  {% else %}
    {{ concept.name }}
  {% endif %}
{% endmacro %}

{% macro data_incoming_relations(relations) %}
  {% if relations|length > 0 %}
    {% set title = 'concept.incoming-relations'|trans %}
    {% set incoming = true %}
    {{ block('data_display_relations') }}
  {% endif %}
{% endmacro %}

{% macro data_outgoing_relations(relations) %}
  {% if relations|length > 0 %}
    {% set title = 'concept.outgoing-relations'|trans %}
    {% set incoming = false %}
    {{ block('data_display_relations') }}
  {% endif %}
{% endmacro %}

{% macro data_prior_knowledge(data) %}
  {% if data|length > 0 %}
    <h2>{{ 'concept.prior-knowledge'|trans }}</h2>
    <ul>
      {% for priorKnowledge in data %}
        <li>
          <a href="{{ path('app_concept_show', {'concept': priorKnowledge.id}) }}">{{ priorKnowledge.name }}</a>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}

{% macro data_learning_outcomes(data) %}
  {% if data|length > 0 %}
    <h2>{{ 'concept.learning-outcomes'|trans }}</h2>
    <ul>
      {% for learningOutcome in data %}
        <li>
          <a href="{{ path('app_learningoutcome_show', { learningOutcome: learningOutcome.id }) }}"><b>{{ learningOutcome.shortName }}</b></a>
          <div class="ltb-text-container">
            {{ learningOutcome.text|striptags(allowed_ckeditor_tags)|raw }}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}

{% macro data_concepts(data) %}
  {% if data|length > 0 %}
    <h2>{{ 'menu.concept'|trans }}</h2>
    <ul>
      {% for concept in data %}
        <li>
          <a href="{{ path('app_concept_show', { concept: concept.id}) }}"><b>{{ concept.name }}</b></a>
          {# Show definition is available, otherwise introduction if available #}
          {% if concept.definition|length > 0 %}
            <div class="ltb-text-container">
              {{ concept.definition }}
            </div>
          {% elseif concept.introduction.text|length > 0 %}
            <div class="ltb-text-container">
              {{ concept.introduction.text|striptags(allowed_ckeditor_tags)|raw }}
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}

{% macro data_learning_paths(data) %}
  {% if data|length > 0 %}
    <h2>{{ 'menu.learning-paths'|trans }}</h2>
    <ul>
      {% for learningPath in data %}
        <li>
          <a href="{{ path('app_learningpath_show', { learningPath: learningPath.id }) }}">{{ learningPath.name }}</a>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}
