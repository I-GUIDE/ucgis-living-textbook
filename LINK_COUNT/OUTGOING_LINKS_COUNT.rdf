Prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
Prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
Prefix owl: <http://www.w3.org/2002/07/owl#>
Prefix foaf: <http://xmlns.com/foaf/0.1/>

select distinct ?node1URI (count(?node2URI) as ?count)
#?node2URI ?node1Label ?node2Label ?node1Link ?node2Link ?relationLabel

{
Graph <http://living.textbook.gis_rs>
{
{?node1URI a owl:Class}

Union
{?node1URI rdfs:subClassOf [owl:someValuesFrom ?node2URI;
                            owl:onProperty ?relation].
}

Union {?node1URI ?relation ?node2URI}

?node1URI rdfs:label ?node1Label.
?node2URI rdfs:label ?node2Label.
?relation rdfs:label ?relationLabel.

#Optional {?node1URI foaf:isPrimaryTopicOf ?node1Link}
#Optional {?node2URI foaf:isPrimaryTopicOf ?node2Link}


Filter (?relation != rdf:type)
Filter (isBlank(?node2URI) = false)
Filter (isBlank(?node1URI) = false)
#Filter (?node1URI != owl:NamedIndividual)
#Filter (?node2URI != owl:NamedIndividual)

}
} # order by ?node1URI
Group by ?node1URI
Order by ?count